<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UnderCover — Full Game (Ready to run)</title>
  <style>
    :root{--bg:#08040b;--card:#1a1020;--accent1:#8e47f4;--accent2:#b78cff;--gold:#ffd54d}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto,'Helvetica Neue';background:radial-gradient(circle at 10% 10%, rgba(163,91,242,0.06), transparent 12%), radial-gradient(circle at 90% 90%, rgba(107,46,160,0.04), transparent 18%), var(--bg);color:#efe7ff}
    .wrap{max-width:1120px;margin:22px auto;padding:18px}
    .cover{display:flex;flex-direction:column;align-items:center;gap:12px;padding:26px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));box-shadow:0 18px 60px rgba(0,0,0,0.7)}
    h1{font-size:2rem;margin:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;color:transparent}
    p.lead{color:#d9ccff;margin:0;text-align:center}
    .btn{margin-top:8px;padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#130224;font-weight:800;cursor:pointer}

    .screen{display:none;margin-top:18px}
    .active{display:block}

    .setup{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    label{display:block;font-size:0.9rem;color:#cfbfff;margin-top:8px}
    input[type=text], textarea, input[type=number]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .names-list{max-height:260px;overflow:auto;margin-top:8px;padding-right:6px}
    .flex{display:flex;gap:8px;align-items:center}

    .card3d{width:360px;height:520px;display:flex;align-items:center;justify-content:center;perspective:1400px;margin:0 auto}
    .card-inner{width:100%;height:100%;border-radius:18px;transform-style:preserve-3d;transition:transform .6s;position:relative}
    .card-inner.flip{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;border-radius:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:22px;backface-visibility:hidden}
    .face.front{background:linear-gradient(180deg, rgba(26,16,32,0.9), rgba(12,6,20,0.95));box-shadow:0 40px 100px rgba(0,0,0,0.7)}
    .face.back{background:linear-gradient(180deg, rgba(58,28,96,0.95), rgba(20,8,36,0.98));transform:rotateY(180deg);box-shadow:0 40px 120px rgba(0,0,0,0.75)}
    .role{font-size:1.8rem;font-weight:900;letter-spacing:1px}
    .clue{margin-top:12px;font-size:1.05rem;text-align:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));width:100%}
    .gold-dot{position:absolute;right:-30px;top:-30px;width:140px;height:140px;border-radius:50%;filter:blur(34px);background:radial-gradient(circle at 30% 30%, rgba(255,213,77,0.95), transparent 40%)}

    .controls{display:flex;gap:8px;justify-content:center;margin-top:12px}
    .small{padding:8px 10px;border-radius:8px;font-weight:800;border:none;background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#120018}

    .note{font-size:0.9rem;color:#d6cfff;text-align:center;margin-top:10px}

    @media (max-width:980px){.setup{grid-template-columns:1fr}.card3d{width:300px;height:420px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="cover" class="cover">
      <h1>UNDERCOVER</h1>
      <p class="lead">Misteri, tawa, dan curiga — main aman buat tongkrongan 18+ (tanpa jorok).<br>Ungu mistis + gold glow. Klik mulai kalau siap.</p>
      <button id="start" class="btn">Mulai</button>
    </div>

    <div id="setupScreen" class="screen">
      <div class="setup">
        <div class="panel">
          <h3>Setup pemain</h3>
          <label>Masukkan nama satu per baris (atau kosongkan untuk nama otomatis)</label>
          <textarea id="namesInput" style="height:160px" placeholder="Nanda
Juwa
Budi"></textarea>
          <div class="flex">
            <div style="flex:1">
              <label>Jumlah pemain (3–20)</label>
              <input id="playerCount" type="number" min="3" max="20" value="6" />
            </div>
            <div style="width:150px">
              <label>Mr White</label>
              <input id="mrCount" type="number" min="0" max="5" value="1" />
            </div>
          </div>
          <div class="flex">
            <div style="flex:1">
              <label>Undercover</label>
              <input id="underCount" type="number" min="0" max="5" value="1" />
            </div>
            <div style="width:150px">
              <label>Civil (otomatis)</label>
              <input id="civilCount" type="number" min="0" max="20" value="4" />
            </div>
          </div>

          <label>Clue contoh (bisa diubah):</label>
          <input id="exampleClue" type="text" value="gunung" />

          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="buildBtn" class="btn">Siapkan & Mulai Game</button>
            <button id="backCover" class="small">Kembali</button>
          </div>
          <div class="note">Flow: Judul → Setup nama satu-satu (Next tiap nama) → Main. Saat buka kartu, hanya pemain yang lihat. Tekan Next untuk pemain berikutnya. Loop saat selesai.</div>
        </div>

        <div class="panel">
          <h3>Daftar pemain (urut tampil saat setup)</h3>
          <div class="names-list" id="playersList"></div>

          <label style="margin-top:8px">Tambahkan nama cepat</label>
          <div class="flex">
            <input id="quickName" type="text" placeholder="Nama..." />
            <button id="addName" class="small">Tambah</button>
          </div>

          <div style="margin-top:10px">
            <label>Preview aturan kartu (akan muncul di kartu pemain)</label>
            <div style="margin-top:6px;color:#d7cffb;font-size:0.95rem">Mr White: tidak diberi clue. Undercover: clue mirip tapi beda. Civil: clue asli. Buka kartu hanya saat giliranmu. Tekan NEXT untuk pemain berikutnya.</div>
          </div>
        </div>
      </div>
    </div>

    <div id="gameScreen" class="screen">
      <div class="panel" style="text-align:center">
        <h3 id="turnInfo">Giliran: -</h3>
        <div class="card3d">
          <div class="card-inner" id="cardInner">
            <div class="face front">
              <div class="gold-dot"></div>
              <div style="text-transform:uppercase;color:rgba(255,255,255,0.7);letter-spacing:1px;font-weight:700">Giliran</div>
              <div id="displayName" style="font-size:1.2rem;margin-top:8px;font-weight:800"></div>
              <div class="role" id="displayRole">Tekan OPEN</div>
              <div class="clue" id="displayClue" style="display:none"></div>
            </div>
            <div class="face back">
              <div style="text-transform:uppercase;color:rgba(255,255,255,0.7);letter-spacing:1px;font-weight:700">Aturan singkat</div>
              <div style="font-weight:700;font-size:1.05rem;margin-top:12px">Mr White: gak dapet clue — nebak dari diskusi.<br>Undercover: dapet clue yang mirip, hati-hati jangan kebuka.<br>Civil: dapet clue asli.</div>
            </div>
          </div>
        </div>

        <div class="controls">
          <button id="openBtn" class="btn">OPEN</button>
          <button id="nextBtn" class="small">NEXT</button>
          <button id="revealBtn" class="small">Ringkasan (Host)</button>
        </div>
        <div id="gameNote" class="note"></div>
      </div>
    </div>

    <div id="endScreen" class="screen panel">
      <h3>Permainan Selesai</h3>
      <div id="summary"></div>
      <div style="margin-top:12px">
        <button id="restart" class="btn">Main Lagi</button>
      </div>
    </div>

    <div style="height:18px"></div>
  </div>

  <script>
    // --- CLUE GENERATOR: buat >1000 clue dari kombinasi base + modifier supaya ringan di file
    const base = [
      'mie instan','kopi','skripsi','wifi kampus','pacar','chat read','nasi padang','martabak','cincin','sepatu','jaket kulit','motor matic','motor sport','kosan','kost','kamar mandi','dosen','asdos','skripsi revisi','magang','kantor','meeting','deadline','ngopi','nugas','jomblo','jomblo bahagia','gebetan','stlh baper','lampu taman','kamar kos','meja belajar','kamera','lensa','vlog','subscriber','like','komentar','tugas kelompok','nilai A','nilai B','kado ultah','ulang tahun','kue tart','nasi kuning','soto ayam','bakso','cemilan','mie ayam','indomie rebus','televisi','streaming','netflix','spotify','soundtrack','lagu galau','lagu viral','drama korea','anime','manga','komik','novel','puisi','catatan','diary','rahasia','gosip kampus','anak kos','tetangga','satpam','security','parkiran','motor','mobil','ojol','driver','resto','warteg','kafe','coffeeshop','kopi susu','kopi hitam','espresso','americano','cappuccino','matcha','boba','teh tarik','juice','smoothie','bibit tanaman','taman','gunung','pantai','laut','danau','sawah','kota','kampung','kampus','kampus lama','lab komputer','lab kimia','perpustakaan','rak buku','skripsi draft','presentasi','slide','proyektor','remote','speaker','headset','mic','panggung','event','panitia','panitia OSPEK','senam pagi','yoga','gym','fitness','sepedaan','lari pagi','malam minggu','nongkrong','tongkrongan','curhat','curhat late-night','nangis','ketawa','jahil','iseng','meme','meme lucu','stiker WA','status','story','reels','shorts','challenge','trend','fashion','sneakers','tas branded','dompet','uang receh','uang gajian','utang','tabungan','investasi','kredit','kartu kredit','ATM','internet banking','voucher','diskon','promo','kupon','harga murah','hobi','main game','e-sport','console','PC gaming','mouse','keyboard','monitor','laptop','charger','powerbank','battery','kopdar',' reuni','pacaran online','pacaran offline','pacaran toxic','gebetan lama','pacar dulu','mantan','mantan baik','mantan nyebelin','pelukan','ciuman','kencan','ngajak nonton','bioskop','film horor','film komedi','standup','komika','olahraga','bola','sepakbola','futsal','basket','voli','bulu tangkis','renang','surfing','travel','backpacking','hotel','hostel','tiket pesawat','kereta','bis','jalan-jalan','murah meriah','budget','kantin','kantin kampus','warung','pedagang','pedagang kaki lima','bakul','penjual','oase','AC','kipas angin','kipas angin angin','AC rusak','listrik padam'
    ];
    const modifiers = ['malam','pagi','siang','tengah','si kecil','besar','ekstra','pedas','manis','basi','hangat','dingin','kering','basah','viral','legend','classic','mini','maxi','murah','mahal','premium','ekonomis','spesial','limited','promo','gratis','berbayar','rahasia','rahasia banget','receh','garing','baper','ngenes','konyol','nyeleneh','gokil','santai','kenceng','lembut','kasar','halus','rombongan','sendiri','soliter','berpasangan','rombongan','kilat','random','nggak penting','terlaris','jadul','modern','kpop','korean','jepang','amerika','indo','lokal','impor','DIY','handmade','professional','amatir','late-night','morning','afterparty','preparty','on-the-go','soho','remote','offline','online','full','half','double','single','original','fake'];

    // build civil clues by combining base + modifiers until >1000 unique
    const civilCluesSet = new Set();
    // first include plain bases
    base.forEach(b=>civilCluesSet.add(b));
    // then combine
    for(let i=0;i<10000 && civilCluesSet.size<1200;i++){
      const b = base[Math.floor(Math.random()*base.length)];
      const m = modifiers[Math.floor(Math.random()*modifiers.length)];
      civilCluesSet.add(b + ' ' + m);
    }
    const civilClues = Array.from(civilCluesSet).slice(0,1100); // take 1100 clues

    // a small synonyms map for common bases to make undercover clues feel "nearby"
    const sim = {
      'mie instan':'mie rebus','kopi':'americano','skripsi':'tesis','wifi kampus':'hotspot kampus','pacar':'gebetan','nasi padang':'rendang','martabak':'martabak manis','cincin':'cincin tunangan','sepatu':'sneakers','jaket kulit':'parka','motor matic':'motor bebek','motor sport':'motor gede','kosan':'kost','dosen':'pak dosen','asdos':'asisten dosen','magang':'praktek kerja','kantor':'kantor cabang','meeting':'rapat','deadline':'tenggat','ngopi':'nongkrong kopi','jomblo':'single','gebetan':'crush','kue tart':'kue ulang tahun','soto ayam':'soto lamongan','bakso':'bakso urat','televisi':'TV kabel','streaming':'nonton online','netflix':'streaming app','anime':'kartun jepang','novel':'buku cerita','puisi':'syair','anak kos':'anak kost','satpam':'security','parkiran':'area parkir','ojol':'driver online','resto':'restoran','coffeeshop':'kedai kopi','kopi susu':'latte','kopi hitam':'black coffee','boba':'bubble tea','gunung':'merapi','pantai':'karang pantai','kampus':'kampus utama','lab komputer':'lab IT','perpustakaan':'perpus','proyektor':'LCD projector','mic':'mikrofon','event':'acara','panitia':'committee','fitness':'gym','malam minggu':'weekend','tongkrongan':'nongkrong','curhat':'curahan hati','meme':'meme kocak','sneakers':'sepatu casual','dompet':'wallet','uang gajian':'gajian','utang':'hutang','tabungan':'saving','investasi':'reksadana','voucher':'kupon','game':'permainan','PC gaming':'komputer game','laptop':'notebook','charger':'pengisi daya','powerbank':'bank daya','pacaran online':'pacaran virtual','mantan':'bekas pacar','pelukan':'peluk','ciuman':'cium','bioskop':'cinema','film horor':'film seram','standup':'komedi standup','bola':'sepak bola','futsal':'mini soccer','basket':'basketball','travel':'perjalanan','hostel':'penginapan murah','tiket pesawat':'boarding pass','kereta':'KA','jalan-jalan':'travelling','kantin':'warung makan','warteg':'warung tegal','pedagang':'penjual keliling','AC':'pendingin ruangan','listrik padam':'mati listrik'
    };

    // function to produce undercover clue from civil clue
    function undercoverOf(clue){
      // if exact in sim map return that
      const key = Object.keys(sim).find(k=> clue.startsWith(k));
      if(key) return sim[key];
      // else try small modifications: replace a word with similar suffix/prefix or pick one word
      const parts = clue.split(' ');
      if(parts.length===1){
        // add modifier or change one char
        const mod = modifiers[Math.floor(Math.random()*modifiers.length)];
        if(Math.random()<0.5) return parts[0] + ' ' + mod;
        // change a vowel
        return parts[0].replace(/[aiueo]/i, c=> String.fromCharCode(c.charCodeAt(0)+1)) || parts[0]+'x';
      }else{
        // swap last word with a modifier or synonym
        if(Math.random()<0.6) return parts.slice(0,parts.length-1).join(' ') + ' ' + modifiers[Math.floor(Math.random()*modifiers.length)];
        // or tweak a letter
        parts[parts.length-1] = parts[parts.length-1].split('').map((ch,i)=> i===0? ch : ch).join('');
        return parts.join(' ');
      }
    }

    // --- Game logic ---
    let players = [];
    let deck = [];
    let idx = 0;
    let started = false;

    const cover = document.getElementById('cover');
    const startBtn = document.getElementById('start');
    const setupScreen = document.getElementById('setupScreen');
    const gameScreen = document.getElementById('gameScreen');
    const endScreen = document.getElementById('endScreen');

    const namesInput = document.getElementById('namesInput');
    const playerCount = document.getElementById('playerCount');
    const mrCount = document.getElementById('mrCount');
    const underCount = document.getElementById('underCount');
    const civilCount = document.getElementById('civilCount');
    const playersList = document.getElementById('playersList');
    const quickName = document.getElementById('quickName');
    const addName = document.getElementById('addName');
    const buildBtn = document.getElementById('buildBtn');
    const backCover = document.getElementById('backCover');

    const displayName = document.getElementById('displayName');
    const displayRole = document.getElementById('displayRole');
    const displayClue = document.getElementById('displayClue');
    const cardInner = document.getElementById('cardInner');
    const openBtn = document.getElementById('openBtn');
    const nextBtn = document.getElementById('nextBtn');
    const turnInfo = document.getElementById('turnInfo');
    const revealBtn = document.getElementById('revealBtn');
    const gameNote = document.getElementById('gameNote');
    const restart = document.getElementById('restart');
    const summary = document.getElementById('summary');

    startBtn.addEventListener('click', ()=>{cover.classList.remove('active'); cover.style.display='none'; setupScreen.classList.add('active');});

    // quick add
    addName.addEventListener('click', ()=>{
      const v = quickName.value.trim(); if(!v) return; namesInput.value += (namesInput.value? '
' : '') + v; quickName.value=''; renderPlayersPreview();
    });

    function renderPlayersPreview(){
      const raw = namesInput.value.trim(); const arr = raw? raw.split('
').map(s=>s.trim()).filter(Boolean) : [];
      playersList.innerHTML = arr.map((n,i)=>`<div style="padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.03)">${i+1}. ${n}</div>`).join('');
    }
    namesInput.addEventListener('input', renderPlayersPreview);

    backCover.addEventListener('click', ()=>{setupScreen.classList.remove('active'); cover.style.display='block'; cover.classList.add('active');});

    buildBtn.addEventListener('click', ()=>{
      // build players array
      const raw = namesInput.value.trim();
      let arr = raw? raw.split('
').map(s=>s.trim()).filter(Boolean) : [];
      const pc = parseInt(playerCount.value)||arr.length||6;
      if(arr.length>pc) {alert('Jumlah nama melebihi jumlah pemain. Sesuaikan jumlah pemain atau hapus nama.'); return}
      // fill auto names
      while(arr.length<pc) arr.push('P'+(arr.length+1));
      const mr = parseInt(mrCount.value)||1;
      const un = parseInt(underCount.value)||1;
      const cv = pc - mr - un;
      if(cv<0){alert('Jumlah peran tidak cocok. Sesuaikan jumlah Mr White/Undercover.');return}
      // build deck array
      deck = [];
      for(let i=0;i<mr;i++) deck.push('mrwhite');
      for(let i=0;i<un;i++) deck.push('undercover');
      for(let i=0;i<cv;i++) deck.push('civil');
      // shuffle
      deck = deck.sort(()=>Math.random()-0.5);
      players = arr.map((n,i)=>({name:n,role:deck[i],seen:false,clue:null}));
      // assign clues for civil/undercover
      for(let i=0;i<players.length;i++){
        if(players[i].role==='civil'){
          const c = civilClues[Math.floor(Math.random()*civilClues.length)];
          players[i].clue = c;
        }
      }
      // for undercover, try to pick a civil clue then make it nearby
      const civilPool = players.filter(p=>p.role==='civil').map(p=>p.clue);
      players.forEach(p=>{
        if(p.role==='undercover'){
          const seed = civilPool[Math.floor(Math.random()*civilPool.length)] || civilClues[Math.floor(Math.random()*civilClues.length)];
          p.clue = undercoverOf(seed);
        }
      });

      idx = 0; started = true; setupScreen.classList.remove('active'); gameScreen.classList.add('active'); updateTurn();
    });

    function updateTurn(){
      if(!started) return;
      const p = players[idx];
      turnInfo.textContent = `Giliran: ${idx+1} / ${players.length}`;
      displayName.textContent = p.name;
      displayRole.textContent = 'Tekan OPEN';
      displayClue.style.display='none';
      cardInner.classList.remove('flip');
      gameNote.textContent = 'Buka kartu hanya saat giliranmu. Setelah buka, pencet NEXT.';
    }

    openBtn.addEventListener('click', ()=>{
      if(!started) return;
      const p = players[idx];
      if(p.seen) { alert('Kartu sudah dibuka di giliranmu. Pencet NEXT untuk pemain berikutnya.'); return }
      // reveal
      if(p.role==='mrwhite'){
        displayRole.textContent = 'MR WHITE';
        displayClue.style.display='block';
        displayClue.textContent = 'Mr White: kamu tidak mendapat clue. Dengarkan diskusi dan tebak nanti.';
      }else if(p.role==='undercover'){
        displayRole.textContent = 'UNDERCOVER';
        displayClue.style.display='block';
        displayClue.textContent = p.clue;
      }else{
        displayRole.textContent = 'CIVIL';
        displayClue.style.display='block';
        displayClue.textContent = p.clue;
      }
      cardInner.classList.add('flip');
      players[idx].seen = true;
    });

    nextBtn.addEventListener('click', ()=>{
      if(!started) return;
      // move to next player
      idx = (idx+1) % players.length;
      // if all seen and you want to loop, still continue
      updateTurn();
    });

    revealBtn.addEventListener('click', ()=>{
      if(!started) return;
      if(!confirm('Tampilkan ringkasan peran untuk semua pemain? (Hanya untuk host)')) return;
      summary.innerHTML = players.map((p,i)=>`<div>${i+1}. ${p.name} — <strong>${p.role.toUpperCase()}</strong> ${p.role!=='mrwhite'? '- Clue: '+p.clue : ''}</div>`).join('');
      gameScreen.classList.remove('active'); endScreen.classList.add('active');
    });

    restart.addEventListener('click', ()=>{location.reload();});

    // initialize preview
    renderPlayersPreview();
  </script>
</body>
</html>
